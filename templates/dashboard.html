{% extends "base.html" %}

{% block title %}Dashboard - Withdean Youth FC{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-tachometer-alt text-danger"></i> 
            Your Fixture Management Dashboard
        </h1>
        <div class="alert alert-primary">
            <i class="fas fa-user-check"></i> 
            Showing <strong>{{ my_teams_count }} your managed teams</strong> only. 
            {{ total_tasks - summary.total }} other club fixtures are hidden. 
            <a href="{{ url_for('view_tasks', show_all='true') }}" class="alert-link">View all club fixtures</a>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <a href="{{ url_for('view_tasks', status='pending') }}" class="text-decoration-none">
            <div class="card bg-warning text-white shadow-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Pending</h5>
                            <h2>{{ summary.pending }}</h2>
                            <p class="card-text">Home games to send</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    
    <div class="col-md-3">
        <a href="{{ url_for('view_tasks', status='waiting') }}" class="text-decoration-none">
            <div class="card bg-info text-white shadow-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Waiting</h5>
                            <h2>{{ summary.waiting }}</h2>
                            <p class="card-text">Away games waiting</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-hourglass-half fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    
    <div class="col-md-3">
        <a href="{{ url_for('view_tasks', status='in_progress') }}" class="text-decoration-none">
            <div class="card bg-primary text-white shadow-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">In Progress</h5>
                            <h2>{{ summary.in_progress }}</h2>
                            <p class="card-text">Currently working on</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-spinner fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
    
    <div class="col-md-3">
        <a href="{{ url_for('view_tasks', status='completed') }}" class="text-decoration-none">
            <div class="card bg-success text-white shadow-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Completed</h5>
                            <h2>{{ summary.completed }}</h2>
                            <p class="card-text">Tasks finished</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-check fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <a href="{{ url_for('upload_file') }}" class="btn btn-danger btn-lg w-100 mb-3">
                            <i class="fas fa-upload"></i> Import New Fixtures
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="{{ url_for('view_tasks', type='home_email', status='pending') }}" class="btn btn-warning btn-lg w-100 mb-3">
                            <i class="fas fa-envelope"></i> Generate Home Emails
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="{{ url_for('view_tasks', type='away_forward', status='waiting') }}" class="btn btn-info btn-lg w-100 mb-3">
                            <i class="fas fa-forward"></i> Check Away Games
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Tasks -->
<div class="row">
    {% if pending_tasks %}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-clock text-warning"></i> Recent Pending Tasks
                </h6>
            </div>
            <div class="card-body">
                {% for task in pending_tasks %}
                <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                    <div>
                        <strong>{{ task.team }}</strong><br>
                        <small class="text-muted">vs {% if task.opposition and task.opposition|string|lower not in ['nan', 'friendly - manager to sort', 'manager to sort', 'tbc'] %}{{ task.opposition }}{% else %}TBC{% endif %}</small>
                    </div>
                    <a href="{{ url_for('view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
                {% endfor %}
                <a href="{{ url_for('view_tasks', status='pending') }}" class="btn btn-sm btn-warning w-100 mt-2">
                    View All Pending
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if waiting_tasks %}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-hourglass-half text-info"></i> Waiting for Emails
                </h6>
            </div>
            <div class="card-body">
                {% for task in waiting_tasks %}
                <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                    <div>
                        <strong>{{ task.team }}</strong><br>
                        <small class="text-muted">vs {% if task.opposition and task.opposition|string|lower not in ['nan', 'friendly - manager to sort', 'manager to sort', 'tbc'] %}{{ task.opposition }}{% else %}TBC{% endif %}</small>
                    </div>
                    <a href="{{ url_for('view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
                {% endfor %}
                <a href="{{ url_for('view_tasks', status='waiting') }}" class="btn btn-sm btn-info w-100 mt-2">
                    View All Waiting
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if completed_tasks %}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-check text-success"></i> Recently Completed
                </h6>
            </div>
            <div class="card-body">
                {% for task in completed_tasks %}
                <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                    <div>
                        <strong>{{ task.team }}</strong><br>
                        <small class="text-muted">vs {% if task.opposition and task.opposition|string|lower not in ['nan', 'friendly - manager to sort', 'manager to sort', 'tbc'] %}{{ task.opposition }}{% else %}TBC{% endif %}</small>
                    </div>
                    <a href="{{ url_for('view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
                {% endfor %}
                <a href="{{ url_for('view_tasks', status='completed') }}" class="btn btn-sm btn-success w-100 mt-2">
                    View All Completed
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Cleanup Section -->
{% if summary.completed > 10 %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-white">
                <h6 class="mb-0">
                    <i class="fas fa-broom"></i> Housekeeping
                </h6>
            </div>
            <div class="card-body">
                <p>You have {{ summary.completed }} completed tasks. Consider cleaning up old ones to keep the system tidy.</p>
                <form method="POST" action="{{ url_for('cleanup_old_tasks') }}" class="d-inline">
                    <div class="input-group" style="max-width: 300px;">
                        <input type="number" class="form-control" name="days" value="30" min="7" max="365">
                        <span class="input-group-text">days old</span>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-trash"></i> Clean Up
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}