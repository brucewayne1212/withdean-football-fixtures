<div class="kanban-card {% if task.task_type.value == 'home_email' %}priority-medium{% else %}priority-low{% endif %}"
    onclick="window.location.href='{{ url_for('tasks.view_task', task_id=task.id) }}'">

    <div class="d-flex justify-content-between align-items-start mb-2">
        <span
            class="badge {% if task.task_type.value == 'home_email' %}bg-warning text-dark{% else %}bg-info{% endif %}">
            {% if task.task_type.value == 'home_email' %}Home{% else %}Away{% endif %}
        </span>
        <small class="text-muted">{{ task.match_date }}</small>
    </div>

    <h6 class="mb-1 fw-bold">{{ task.team }}</h6>
    <div class="text-muted small mb-2">
        {% if task.task_type.value == 'home_email' %}vs{% else %}@{% endif %}
        {{ task.opposition }}
    </div>

    <div class="card-meta">
        <span><i class="far fa-clock me-1"></i>{{ task.kickoff_time }}</span>
        {% if task.pitch and task.pitch != 'TBC' %}
        <span title="{{ task.pitch }}"><i class="fas fa-map-marker-alt me-1"></i>{{ task.pitch[:10] }}...</span>
        {% endif %}
    </div>

    <div class="card-actions d-flex align-items-center gap-2" onclick="event.stopPropagation()">
        <div class="flex-grow-1">
            {% if task.status.value == 'pending' %}
            {% if task.task_type.value == 'home_email' %}
            <a href="{{ url_for('tasks.generate_email_route', task_id=task.id) }}" class="btn btn-sm btn-primary w-100">
                <i class="fas fa-envelope me-1"></i> Draft Email
            </a>
            {% else %}
            <a href="{{ url_for('tasks.view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-primary w-100">
                <i class="fas fa-eye me-1"></i> View Details
            </a>
            {% endif %}
            {% elif task.status.value == 'waiting' %}
            <a href="{{ url_for('tasks.view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-info w-100">
                <i class="fas fa-reply me-1"></i> Log Reply
            </a>
            {% elif task.status.value == 'completed' %}
            <button class="btn btn-sm btn-light w-100 disabled">
                <i class="fas fa-check me-1"></i> Done
            </button>
            {% else %}
            <a href="{{ url_for('tasks.view_task', task_id=task.id) }}" class="btn btn-sm btn-outline-secondary w-100">
                <i class="fas fa-eye me-1"></i> View
            </a>
            {% endif %}
        </div>

        <div class="dropdown">
            <button class="btn btn-sm btn-light text-muted" type="button" data-bs-toggle="dropdown"
                aria-expanded="false" title="Change Status">
                <i class="fas fa-ellipsis-v"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
                <li>
                    <h6 class="dropdown-header">Change Status</h6>
                </li>
                <li><button class="dropdown-item" onclick="updateTaskStatus('{{ task.id }}', 'pending')"><i
                            class="fas fa-clock text-warning me-2"></i>Pending</button></li>
                <li><button class="dropdown-item" onclick="updateTaskStatus('{{ task.id }}', 'in_progress')"><i
                            class="fas fa-spinner text-primary me-2"></i>In Progress</button></li>
                <li><button class="dropdown-item" onclick="updateTaskStatus('{{ task.id }}', 'waiting')"><i
                            class="fas fa-hourglass text-info me-2"></i>Waiting</button></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><button class="dropdown-item" onclick="updateTaskStatus('{{ task.id }}', 'completed')"><i
                            class="fas fa-check text-success me-2"></i>Completed</button></li>
            </ul>
        </div>
    </div>
</div>